<?php
// homepage.php (dynamic, menggunakan tabel ebooks)
session_start();
require 'koneksi.php';

// Ambil 12 ebook terbaru (sesuaikan nama tabel/kolom dengan database kamu)
$products = $db->query("SELECT * FROM ebooks ORDER BY created_at DESC LIMIT 12");

// Deteksi status login / role
$isLoggedIn = isset($_SESSION['username']);
$isAdmin = isset($_SESSION['role']) && $_SESSION['role'] === 'admin';

?>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lorapz Store â€” Marketplace E-Book</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{
            --bg: #f5f7fb;
            --card: #ffffff;
            --text: #111827;
            --muted: #6b7280;
            --accent: #0d6efd;
        }
        body{font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); color:var(--text);}
        .navbar-brand{font-weight:700}
        .hero{height:50vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(90deg, rgba(13,110,253,0.85), rgba(14,165,233,0.85)); color:white; text-align:center}
        .hero h1{font-size:2.4rem; margin-bottom:.3rem}
        .hero p{opacity:.9}
        .product-grid{display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:1.25rem}
        .card-product{background:var(--card); border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(16,24,40,0.06)}
        .card-product img{width:100%; height:160px; object-fit:cover}
        .card-body{padding:12px}
        footer{padding:24px; text-align:center; color:var(--muted)}

        /* dark mode */
        body.dark{--bg:#0b1220; --card:#0f1724; --text:#e6eef8; --muted:#9aa8bf}
        body.dark .hero{background:linear-gradient(90deg, rgba(29,78,216,0.95), rgba(6,95,70,0.95))}

        .theme-toggle{border:0; background:transparent; font-size:1.05rem}
        .nav-actions a{margin-left:.75rem}
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="index.php">Lorapz Store</a>

    <div class="d-flex align-items-center nav-actions">
        <button id="theme-toggle" class="theme-toggle btn btn-sm">ðŸŒ“</button>
        <?php if ($isLoggedIn): ?>
            <span class="me-2">Halo, <?= htmlspecialchars($_SESSION['username']) ?></span>
            <?php if ($isAdmin): ?>
                <a class="btn btn-sm btn-outline-primary" href="dashboard.php">Admin</a>
            <?php endif; ?>
            <a class="btn btn-sm btn-outline-secondary" href="logout.php">Logout</a>
        <?php else: ?>
            <a class="btn btn-sm btn-primary" href="login.php">Login</a>
        <?php endif; ?>
    </div>
  </div>
</nav>

<section class="hero">
    <div class="container">
        <h1>Temukan E-Book & Produk Digital Berkualitas</h1>
        <p>Materi pelajaran, template, dan ebook kreatif â€” siap diunduh segera.</p>
        <div style="margin-top:1rem">
            <a href="#produk" class="btn btn-light">Lihat Produk</a>
        </div>
    </div>
</section>

<section id="produk" class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Produk Terbaru</h3>
        <div class="text-muted">Menampilkan 12 terbaru</div>
    </div>

    <div class="product-grid">
        <?php
        // Path ke file upload fallback (image yang diupload user sebelumnya dari session developer)
        $fallback = '/mnt/data/d88d477f-2d11-4afc-8d37-9de4f53e5b0e.png';

        if ($products && $products->num_rows > 0) :
            while ($p = $products->fetch_assoc()):
                $title = htmlspecialchars($p['title'] ?? $p['name'] ?? 'Untitled');
                $price = isset($p['price']) ? number_format($p['price'],0,',','.') : '0';
                // asumsi ada kolom image yang berisi nama file di folder uploads/
                $img = !empty($p['image']) ? ('uploads/' . htmlspecialchars($p['image'])) : $fallback;
        ?>
        <div class="card-product">
            <img src="<?= $img ?>" alt="<?= $title ?>">
            <div class="card-body">
                <h5 style="margin:0; font-size:1rem"><?= $title ?></h5>
                <div class="text-muted small">Rp <?= $price ?></div>
                <div style="margin-top:.5rem">
                    <a class="btn btn-sm btn-outline-primary" href="product.php?id=<?= $p['id'] ?? $p['ebook_id'] ?>">Lihat</a>
                    <a class="btn btn-sm btn-primary" href="buy.php?id=<?= $p['id'] ?? $p['ebook_id'] ?>">Beli</a>
                </div>
            </div>
        </div>
        <?php
            endwhile;
        else:
        ?>
        <div class="card p-4">
            <div class="card-body text-center">
                <p class="mb-0">Belum ada produk. Silakan tambahkan data di database (tabel `ebooks`).</p>
            </div>
        </div>
        <?php endif; ?>
    </div>
</section>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-6 text-start">
                <strong>Lorapz Store</strong><br>
                Marketplace E-Book & Produk Digital
            </div>
            <div class="col-md-6 text-end text-muted">
                &copy; <?= date('Y') ?> Lorapz Store
            </div>
        </div>
    </div>
</footer>

<script>
// Dark mode toggle (simpan preferensi di localStorage)
const btn = document.getElementById('theme-toggle');
btn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    localStorage.setItem('lorapz_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
});
if (localStorage.getItem('lorapz_theme') === 'dark') {
    document.body.classList.add('dark');
}
</script>

</body>
</html>
